<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>Document</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"></script>

    <script src="https://momentjs.com/downloads/moment-with-locales.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
    <link href="style.css" rel="stylesheet"/>
  </head>
  <body>
    Press control to select multiple, use slider to darken. <br/>
    <input type="range" id="total" min="0" max="7">
    <!--     <button id="saveButton">SAVE</button> -->
    <div class="grid"></div>
    <script src="./streak.js"></script>
    
    <script>
      let clickStack = [];
      
      let frequencyStreak = parseDiaryClockString(clockStrExample)

      var margin = {top: 20, right: 20, bottom: 50, left: 70},
	  width = 960 - margin.left - margin.right,
	  height = 500 - margin.top - margin.bottom;

      var grid = d3.select(".grid")
          .append("svg")
	  .attr("width","510px")
	  .attr("height","510px")
      
      var row = grid.selectAll(".row")
	  .data(gridData2)
	  .enter().append("g")
	  .attr("class", "row");

      var colorScale = d3.scaleThreshold()
	  .domain(_.range(0, 6))
	  .range(d3.schemeBlues[0, 1, 2, 3, 4, 5, 6]);
      
      var cell = row.selectAll(".square")
	  .data(function(d) { return d; })
	  .enter().append("rect")
	  .attr("class","square")
	  .attr("stroke-width", 2)
	  .attr("x", function(d) { return d.x; })
	  .attr("y", function(d) { return d.y; })
	  .attr("width", function(d) { return d.width; })
	  .attr("height", function(d) { return d.height; })
	  .attr("fill", (d, i) => {
	    d.date = moment(d.date).format(moment.HTML5_FMT.DATE)
	    d.total = frequencyStreak[d.date] || 0;
	    return colorScale(d.total);
	  }).on("mousedown", (d, i) => {
	    // console.log(this, d)
	    // console.log(d3.select(d).classed("active", true))
	    total.value = d.total
	    document.body.title = d.total
	  })

      total.addEventListener("input", e => {
	document.querySelectorAll(".active").forEach(active => {
	  d3.select(active).attr("fill", (d, i) => {
	    console.log(d.total, e.target.value)
	    return colorScale(e.target.value)
	  })
	})

	
      })

      document.querySelectorAll(".square").forEach(square => {
	square.addEventListener("mousedown", (e) => {
	  if(!e.ctrlKey) { 
	    document.querySelectorAll(".active")
	      .forEach(active => active.classList.toggle("active"))
	  }
	  e.target.classList.toggle("active")
	  console.log(document.querySelectorAll(".active"))
        })
      })
      
      
    </script>
  </body>
</html>
